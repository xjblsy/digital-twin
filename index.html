<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>数字孪生考古遗址风险评估系统</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Three.js -->
  <script src="https://unpkg.com/three@0.158.0/build/three.min.js"></script>
  <script src="https://unpkg.com/three@0.158.0/examples/js/controls/OrbitControls.js"></script>
  <script src="https://unpkg.com/three@0.158.0/examples/js/loaders/GLTFLoader.js"></script>

  <style>
    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background: #020617;
      color: #e5e7eb;
      overflow: hidden;
    }

    #layout {
      display: grid;
      grid-template-rows: 56px 1fr 36px;
      height: 100vh;
    }

    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 20px;
      background: rgba(15,23,42,0.9);
      border-bottom: 1px solid rgba(255,255,255,0.08);
    }

    header h1 {
      font-size: 18px;
      font-weight: 600;
    }

    #riskLevel {
      padding: 6px 12px;
      border-radius: 999px;
      font-size: 13px;
      background: #22c55e;
      color: #022c22;
    }

    main {
      display: grid;
      grid-template-columns: 1fr 360px;
    }

    #viewer {
      position: relative;
    }

    #panel {
      background: rgba(15,23,42,0.95);
      border-left: 1px solid rgba(255,255,255,0.08);
      padding: 20px;
      overflow-y: auto;
    }

    h2 {
      font-size: 16px;
      margin-bottom: 12px;
    }

    label {
      font-size: 12px;
      opacity: 0.8;
    }

    input, select {
      width: 100%;
      margin-top: 6px;
      margin-bottom: 14px;
      padding: 8px 10px;
      background: #020617;
      border: 1px solid rgba(255,255,255,0.12);
      border-radius: 8px;
      color: #e5e7eb;
    }

    button {
      width: 100%;
      padding: 10px;
      border: none;
      border-radius: 10px;
      background: linear-gradient(135deg,#3b82f6,#06b6d4);
      color: white;
      font-size: 14px;
      cursor: pointer;
    }

    button:hover { opacity: 0.9; }

    .metric {
      margin-top: 18px;
    }

    .metric strong {
      font-size: 22px;
    }

    footer {
      font-size: 12px;
      opacity: 0.5;
      display: flex;
      align-items: center;
      padding-left: 16px;
      background: rgba(2,6,23,0.9);
      border-top: 1px solid rgba(255,255,255,0.08);
    }
  </style>
</head>
<body>

<div id="layout">
  <header>
    <h1>数字孪生考古遗址风险评估系统</h1>
    <div id="riskLevel">安全</div>
  </header>

  <main>
    <div id="viewer"></div>

    <div id="panel">
      <h2>环境数据输入（模拟）</h2>

      <label>年降雨量 (mm)</label>
      <input id="rain" type="number" value="800" />

      <label>平均湿度 (%)</label>
      <input id="humidity" type="number" value="75" />

      <label>年温差 (℃)</label>
      <input id="temp" type="number" value="15" />

      <label>极端天气频率</label>
      <select id="extreme">
        <option value="1">低</option>
        <option value="2" selected>中</option>
        <option value="3">高</option>
      </select>

      <button onclick="runPrediction()">运行风险评估</button>

      <div class="metric">
        <span>预测风险值</span><br />
        <strong id="riskValue">0.32</strong>
      </div>
    </div>
  </main>

  <footer>
    数字孪生系统原型 · 数据为模拟 · 支持后端模型替换
  </footer>
</div>

<script>
  /* ================= Three.js 数字孪生视图 ================= */
  const container = document.getElementById('viewer');

  const scene = new THREE.Scene();
  scene.background = new THREE.Color(0x020617);

  const camera = new THREE.PerspectiveCamera(60, container.clientWidth / container.clientHeight, 0.1, 100);
  camera.position.set(3, 2.5, 4);

  const renderer = new THREE.WebGLRenderer({ antialias: true });
  renderer.setSize(container.clientWidth, container.clientHeight);
  renderer.setPixelRatio(window.devicePixelRatio);
  container.appendChild(renderer.domElement);

  const controls = new THREE.OrbitControls(camera, renderer.domElement);
  controls.enableDamping = true;

  scene.add(new THREE.AmbientLight(0xffffff, 0.6));
  const light = new THREE.DirectionalLight(0xffffff, 1);
  light.position.set(5, 5, 5);
  scene.add(light);

  // === 示例数字孪生模型（后续可替换为 GLB 遗址模型） ===
  const geometry = new THREE.BoxGeometry(1.5, 1, 1.5);
  const material = new THREE.MeshStandardMaterial({ color: 0x22c55e });
  const twinModel = new THREE.Mesh(geometry, material);
  scene.add(twinModel);

  function riskToColor(risk) {
    const green = new THREE.Color(0x22c55e);
    const yellow = new THREE.Color(0xfacc15);
    const red = new THREE.Color(0xef4444);
    if (risk < 0.5) return green.lerp(yellow, risk * 2);
    return yellow.lerp(red, (risk - 0.5) * 2);
  }

  function updateVisualization(risk) {
    twinModel.material.color.copy(riskToColor(risk));
    document.getElementById('riskValue').innerText = risk.toFixed(2);

    const badge = document.getElementById('riskLevel');
    if (risk < 0.4) {
      badge.innerText = '安全';
      badge.style.background = '#22c55e';
    } else if (risk < 0.7) {
      badge.innerText = '警告';
      badge.style.background = '#facc15';
      badge.style.color = '#422006';
    } else {
      badge.innerText = '高风险';
      badge.style.background = '#ef4444';
      badge.style.color = '#450a0a';
    }
  }

  function runPrediction() {
    // === 模拟风险预测模型（后端可直接替换） ===
    const rain = Number(document.getElementById('rain').value);
    const humidity = Number(document.getElementById('humidity').value);
    const temp = Number(document.getElementById('temp').value);
    const extreme = Number(document.getElementById('extreme').value);

    // 简化线性风险函数（示例）
    let risk =
      0.0003 * rain +
      0.003 * humidity +
      0.01 * temp +
      0.1 * extreme;

    risk = Math.min(1, Math.max(0, risk));
    updateVisualization(risk);
  }

  function animate() {
    requestAnimationFrame(animate);
    twinModel.rotation.y += 0.002;
    controls.update();
    renderer.render(scene, camera);
  }
  animate();

  window.addEventListener('resize', () => {
    camera.aspect = container.clientWidth / container.clientHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(container.clientWidth, container.clientHeight);
  });
</script>
</body>
</html>
